
Percona XtraDB Cluster
PXC属于一套Mysql高可用集群的解决方案，相比传统基于主从复制的集群架构MHA和MM+keepalived，PXC最突出的解决了数据同步的延迟问题。最关注的是数据一致性，对事务处理时要私么在所有节点上执行，要么都不执行。


对galera cluster的封装有两个，虽然名称不同，但实质都是一样的，使用的都是galera cluster。一个MySQL的创始人在自己全新的MariaDB上实现的MAriaDB cluster；一个是著名的MySQL服务和工具提供商percona实现的percona xtradb cluster，简称PXC


PXC架构至少需要3个mysql实例，他们之前不是主从关系，都是对等关系，这就叫multi-master架构。客户端写入和读取数据时，连接哪个实例都是一样的。读取到的数据时相同的，写入任意一个实例之后，集群自己会将新写入的数据同步到其他实例上，这种架构不共享任何数据，是一种高冗余架构。

galera cluster集群特点
* 多主架构：真正的多点读写集群，在任何时间读写到的数据都是一致的。
* 同步复制：集群不同节点之间的数据同步，没有延迟。
* 并发复制：各节点在apply数据时，支持并发执行，有更好的性能表现。
* 故障切换：因为支持多点写入，所以在数据库故障时可以很容易的进行故障切换。
* 热插拨：在服务期间，如果某节点宕机，对集群本身影响非常小。
* 自动节点克隆：在新增节点或停机维护时，增量数据或基础数据时不需人工手动备份，galera cluster会自动拉取在线节点的数据，集群最终会变为一致。
* 对应用透明：集群的维护，对应用程序是透明的。


PXC节点状态
* open：节点启动成功，尝试连接到集群。
* primary：节点已处于集群中，在新节点加入时，选取doner进行数据同步时产生的状态
* joiner：节点处于等待待接收同步文件时的状态。
* joined：节点完成数据同步的工作，尝试保持和集群进度保持一致。
* synced：节点正常提供服务的状态，表示已同步完成并和集群进度保持一致。
* doner：节点处于为新加入的节点提供全量数据时的状态。
doner节点是数据的贡献者，如果一个新节点加入集群，此时又需要大量数据的SST传输，就有可能因此而拖垮整个集群的性能。所以在生产环境中如果数据量较小可以使用SST全量传输，如果数据量很大就不建议使用这种方式了。可以考虑先建立主从关系，再加入集群。


PXC数据传输方式
* SST全量传输：：xtrabackup、mysqldump和rsync三种方法。
* IST增量传输：增量传输就一种方法就是xtrabackup。


PXC常用端口
* 3306：数据库默认端口。
* 4444：请求SST端口。
* 4567：节点之间进行沟通的一个端口号。
* 4568：用于传输IST端口。


PXC集群优点
* 实现了Mysql数据库集群架构的高可用性和数据库的强一致性。
* 实现了真正的多节点读写的集群方案。
* 改善了主从同步的延迟问题，基本达到了实时同步。
* 新加入的节点自动布署，无须手动备份。
* 由于是多节点写入，所以数据库故障切换比较容易。


PXC集群缺点
* 新加入的节点开销大，需要复制完整的数据，采用SST传输开销太大。
* 任何更新事务都需要全局验证通过，才会在每个节点上执行，集群性能受限于单节点。
* 因为需要保证数据一致性，所以在多节点并发写时，锁冲突问题比较严重。
* 存在扩大写问题，所有的节点都会发生些操作。
* 只支持Innodb存储引擎。
* 没有表级别的锁定，执行DDL语句操作会把整个集群锁信。
* 所有的表必须含有主键。