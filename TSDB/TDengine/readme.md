![image-20220508153705312](/Users/apple/Library/Application Support/typora-user-images/image-20220508153705312.png)

Telegraf

Kafka

OPC-UA

MQTT-Broker



![image-20220508153733607](/Users/apple/Library/Application Support/typora-user-images/image-20220508153733607.png)



#### 物联网数据的特点

1. 所有采集的数据都是时序的
2. 数据都是结构化数据为主
3. 一个采集点的数据源是唯一的
4. 数据很少有更新删除操作
5. 数据一般是按时间段来删除
6. 数据以写操作为主，读操作为辅
7. 数据流量平稳，可以较为准确的计算
8. 数据都有统计、聚合等实时计算操作
9. 数据一定是指定时间段和指定区域查询
10. 数据量巨大，高频采集



一个设备一张表，节省设备id的重复存储

列式存储，同一种数据类型更容易压缩，可以针对单列进行计算。



#### 超级表

超级表用以描述同一种类型的数据采集点，采集量的数据结色schema、静态标签的数据结构schema



标签数据和实时数据单独存储



#### 数据高可靠设计

* 通过WAL(Write Ahead Log)来保证
* 入库的数据，总是先写入WAL，再写入内存，再给应用回复确认
* 如果宕机，重启时可以从WAL恢复数据



#### 数据分区

* 按时间段将数据进行分区
* 同一时间段采集数据存放在同一数据文件
* 时间段以天为单位，可以配置

#### 数据分片

* 按照数据采集点进行分片，片称为vnode
* 一个片里有一到多个数据采集点的数据
* 片可以分布在多台计算上
* 一个数据采集点的数据只会在一个片里
* 片通过中心化的管理节点进行管理
* 系统的负载均衡是以vnode为单位进行的