Modbus 国标

GBZ 19582.3-2004
GBZ 19582.1-2004 基于Modbus协议的工业自动化网络规范 第1部分：Modbus应用协议
GBZ 19582.2-2004 基于Modbus协议的工业自动化网络规范 第2部分：Modbus协议在串行链路上的实现指南
GBZ 19582.3-2004 基于Modbus协议的工业自动化网络规范 第3部分：Modbus协议在TCP∕IP上的实现捐南


GBT 19582.1-2008
GBT 19582.1-2008 基于Modbus协议的工业自动化网络规范 第1部分：Modbus应用协议
GBT 19582.2-2008 基于Modbus协议的工业自动化网络规范 第2部分：Modbus协议在串行链路上的实现指南
GBT 19582.3-2008 基于Modbus协议的工业自动化网络规范 第3部分：Modbus协议在TCP∕IP上的实现指南



Modbus是一种串行通信协议，是Modicon公司（现在的施耐德电气Schneider Electric）于1979年为使用可编程逻辑控制器（PLC）通信而发表。Modbus已经成为工业领域通信协议的业界标准（De facto），并且现在是工业电子设备之间常用的连接方式。
一般来说，ModbusRtu和ModbusAscii是运行在串口上的协议，ModbusTcp是运行是以太网上的协议，但是这并非绝对的，我们也可以将ModbusRtu、ModbusAscii运行在以太网或光纤上使用，同样的，在串口网络里，我们也可以使用ModbusTcp的协议，因为协议只是一种规范，并不限制通信介质。

1. ModbusRtu的报文格式如下：
    * 第一部分：从站地址，占1个字节
    * 第二部分：功能码，占1个字节
    * 第三部分：数据部分，占N个字节
    * 第四部分：校验部分，CRC校验，占2个字节
Modbus RTU协议：Modbus RTU协议主要应用于电气自动化和过程控制，一般采用RS-232或RS-485的通信接口。
Modbus RTU协议传输距离短、速度慢，导致应用受到局限。
Modbus RTU协议可以使控制器之间，以及控制器由网络和其它设备之间进行通信。

2. ModbusAscii的报文格式如下：
    * 第一部分：开始字符（:）
    * 第二部分：从站地址，占2个字节
    * 第三部分：功能码，占2个字节
    * 第四部分：数据部分，占N个字节
    * 第五部分：校验部分，LRC校验，占2个字节
    * 第六部分：结束字符（CR LF）

3. ModbusTcp的报文格式如下：
    * 第一部分：事务处理标识符，占2个字节
    * 第二部分：协议标识符，占2个字节
    * 第三部分：长度，占2个字节
    * 第四部分：单元标识符，占1个字节
    * 第五部分：功能码，占1个字节
    * 第六部分：数据部分，占N个字节
Modbus TCP/IP协议：Modbus TCP/IP协议主要应用领域lnternet或lntranet中。
Modbus TCP/IP协议传输距离远、传输速度快，使得应用范围广泛。
Modbus TCP/IP协议提供传输层与网络层之间的服务。

#### modbus模拟软件
* ModbusPoll 软件主要用于仿真 Modbus主站或 Modbus 客户端
* ModbusSlave 软件主要用于仿真 Modbus 从站或 Modbus 服务器
* Modscan32
* VSPD 全称 Configure Virtual Serial Port Driver，是用来给电脑创建虚拟串口使用的。


https://www.modbustools.com/download.html



#### modbus主站从站
一、发出指令不同
1. Modbus主站：Modbus主站可以主动发出指令。
2. Modbus从站：Modbus从站不会主动发出指令。

二、唯一性不同
1. Modbus主站：Modbus主站具有唯一性。
2. Modbus从站：Modbus从站不具有唯一性，可以有多个。

三、对接不同
1. Modbus主站：Modbus主站可以对接多个Modbus从站。
2. Modbus从站：Modbus从站职能对接一个Modbus主站。
主站可以在modbus总线上发布查询命令，在此总线上主站是唯一的。从站可以有多个，它时刻监视总线的报文 ，根据报文响应主站的命令；从站不能发布查询命令，只能响应。

#### RTU和TCP区别
Modbus RTU和Modbus TCP/IP两个协议的本质都是MODBUS协议，都是靠MODBUS寄存器地址来交换数据；但所用的硬件接口不一样，Modbus RTU一般采用串口RS232C或RS485/422，而Modbus TCP一般采用以太网口。 
Modbus协议和Modbus TCP/IP协议区别为：作用不同、传输不同、应用不同。
一、作用不同
1. Modbus RTU协议：Modbus RTU协议可以使控制器之间，以及控制器由网络和其它设备之间进行通信。
2. Modbus TCP/IP协议：Modbus TCP/IP协议提供传输层与网络层之间的服务。
二、传输不同
1. Modbus RTU协议：Modbus RTU协议传输距离短、速度慢，导致应用受到局限。
2. Modbus TCP/IP协议：Modbus TCP/IP协议传输距离远、传输速度快，使得应用范围广泛。
三、应用不同
1. Modbus RTU协议：Modbus RTU协议主要应用于电气自动化和过程控制，一般采用RS-232或RS-485的通信接口。
2. Modbus TCP/IP协议：Modbus TCP/IP协议主要应用领域lnternet或lntranet中。

#### MODBUS Point Type（Modbus数据模型）
* 01:COIL STATUS：读写开关量类型（DO），位操作，可用于设定端口输出状态，或者读取该位的输出状态，常用于电磁阀输出、MOSFET输出、LED显示等；
* 02:INPUT STATUS：读开关量类型（DI），位操作，通过外部设定改变输入状态，可读但是不可写，常用于拨码开关、接近开关等；
* 03:HOLDING REGISTER：保持寄存器，读写WORD类型，字操作，输出参数或者保持参数，控制器运行时被设定的某些参数，可读可写，常用于模拟量输出设定值、PID运行参数、变量阀输出大小、传感器报警上下限等；
* 04:INPUT REGISTER：输入寄存器，读WORD类型，字操作，输入参数，控制器运行时从外部设备获得的参数，可读但是不可写，常用于模拟量输入。

可以读写的布尔类型(0x)   请求类：ReadCoilsRequest                     响应类：ReadCoilsResponse
只能读的布尔类型(1x)      请求类：ReadInputDiscretesRequest       响应类：ReadInputDiscretesResponse
只能读的数字类型(3x)      请求类：ReadInputRegistersRequest       响应类：ReadInputRegistersResponse
可以读写的数字类型(4x)   请求类：ReadMultipleRegistersRequest    响应类：ReadMultipleRegistersResponse


Modbus协议最开始是用于可编程逻辑控制器（PLC）之间的通讯，由于其具有的开放性，大量的用于现场智能仪表。Modbus协议有多个变种，其中最著名的是Modbus RTU/Modbus ASCII和Modbus TCP通信协议。其中RTU/ASCII协议是基于串行口通信，而TCP协议则是基于以太网通信。
#### modbus rtu
PDU
地域域 功能码 数据 校验码

#### modbus tcp
MBAP报文头




#### Modbus错误代码表
* 功能码
* 校验码
* 异常功能码
* 错误代码

其中异常功能码和错误代码非常容易混淆。一般来说异常功能码指的是某个功能码执行的时候出现的相应异常功能码，一般都是在功能码的基础上加上0x80，比如03功能码出现的异常码是0x83异常功能码，16功能码对应出现的异常功能码则是0x90,而错误代码则是表示出现错误的具体情况，比如寄存器地址不存在，不管是读还是写，如果该寄存器地址不存在的话，错误代码为02。

#### modbus异常功能码
响应功能码 = 请求功能码
响应功能码 = 请求功能码+0x80
* 01：非法的功能码
* 02：非法的数据地址
* 03：非法的数据值
* 04：服务器故障
* 05：确认，服务器接受服务调用，但是需要相对长的时间完成服务。因此，服务器仅返回一个服务调用接收的确认。
* 06：服务器忙，服务器不能接受MODBUS请求PDU。
* 0A：网关故障，网关路经是无效的。
* 0B：网关故障，目标设备没有响应。网关生成这个异常信息。

#### modbus操作对象
PDU由功能码+数据组成。功能码为1字节，数据长度不定，由具体功能决定。
* 线圈：PLC的输出位，开关量，可读可写
* 离散量：PLC的输入位，开关量，只读
* 输入寄存器：PLC中只能从模拟量输入端改变寄存器，只读
* 保持寄存器：PLC中用于输出模拟量信号的寄存器，可读可写

| 代码|中文名称 | 英文名 | 位操作/字操作 | 操作数量 |
| 0x01|读线圈状态 | READ COIL STATUS | 位操作 | 单个或多个 |
| 0x02|读离散输入状态 | READ INPUT STATUS | 位操作 | 单个或多个 |
| 0x03|读保持寄存器 | READ HOLDING REGISTER | 字操作 | 单个或多个 |
| 0x04|读输入寄存器 | READ INPUT REGISTER | 字操作 | 单个或多个 |
| 0x05|写线圈状态 | WRITE SINGLE COIL | 位操作 | 单个 |
| 0x06|写单个保持寄存器 | WRITE SINGLE REGISTER | 字操作 | 单个 |
| 0x0F|写多个线圈 | WRITE MULTIPLE COIL | 位操作 | 多个
| 0x10|写多个保持寄存器 | WRITE MULTIPLE REGISTER | 字操作 | 多个  |


#### modbus四种数据
* DI：数字输入，离散输入，一个地址一个数据位，用户只能读取它的状态，不能修改，比如面板上的按键、开关、电机故障状态
* DO：数字输出，一个地址一个数据位，用户可以置位、复位、可以回读状态、例如继电器输出、电机的启停控制信号。
* AI：模似输入、输入寄存器、一个地址16位数据，只读，例如：电压值的读数。模拟量即4-20mA或0-10V的电流或电压信号，输入到DCS中经过变换还原出来的值，
* AO：模似输出，保持寄存器、一个地址16位数据，可读可写。和AI相反，AO是DOCS输出4-20mA或0-10V信号，去控制设备的运行参数。


modbus协议定义的寄存器地址是5位十进制地址，在实际编程中，由于前缀的区分作用，所以只需说明后4位数，而且需转换为4位十六进制地址。
* DO线圈：00000-99999
* DI触点：10000-19999
* AI输入寄存器：30000-39999
* AO输出寄存器：40000-49999



#### 继电器
英文名称：relay）是一种电控制器件，是当输入量（激励量）的变化达到规定要求时，在电气输出电路中使被控量发生预定的阶跃变化的一种电器。它具有控制系统（又称输入回路）和被控制系统（又称输出回路）之间的互动关系。通常应用于自动化的控制电路中，它实际上是用小电流去控制大电流运作的一种“自动开关”。故在电路中起着自动调节、安全保护、转换电路等作用。 
继电器是一种电控制器件,可以给予规定输入量并保持足够长的时间,在电气输出电路中使被控量发生预定的阶跃变化。当输入量降至一定程度并保持足够长的时间后，再恢复到初始状态。


### Modbus具有以下几个特点：

* 标准、开放，用户可以免费、放心地使用Modbus协议，不需要交纳许可证费，也不会侵犯知识产权。目前，支持Modbus的厂家超过400家，支持Modbus的产品超过600种。
* Modbus可以支持多种电气接口，如RS-232、RS-485等，还可以在各种介质上传送，如双绞线、光纤、无线等。 　　
* Modbus的帧格式简单、紧凑，通俗易懂。用户使用容易，厂商开发简单。

　Modbus 协议是应用于电子控制器上的一种通用语言。通过此协议，控制器相互之间、控制器经由网络（例如以太网）和其它设备之间可以通信。它已经成为一通用工业标准。有了它,不同厂商生产的控制设备可以连成工业网络,进行集中监控。此协议定义了一个控制器能认识使用的消息结构，而不管它们是经过何种网络进行通信的。它描述了一控制器请求访问其它设备的过程,如何回应来自其它设备的请求，以及怎样侦测错误并记录。它制定了消息域格局和内容的公共格式。 　　


|   映射地址	| 使用的功能码 |	地址类型 |	存取方式	|   描述    |  
|   0XXXX	|  	01,05,15	|  	离散输出	|  	读写	|  	每个卷表示单个开关位   |  
|   1XXXX	|  	02		|  离散输入	只读	|  	每个卷表示单个开关位   |  
|   2XXXX	|  	03,04,06,16		|  浮点寄存器	只读/读写	|  	两个连续16位寄存器表示一个浮点数   |  
|   3XXXX	|  	04		|  输入寄存器	只读	|  	每个寄存器表示一个16位无符号整数   |  
|   4XXXX	|  	03,06,16		|  保持寄存器	读写	|  	每个寄存器表示一个16位无符号整数   |  
|   5XXXX	|  	03,04,06,16		|  ASCII字符	读写	|  	每个寄存器表示两个ASCII码   |  


CAN
控制器局域网CAN（ Controller Area Network）属于现场总线的范畴，是一种有效支持分布式控制系统的串行通信网络。
是由德国博世公司在20世纪80年代专门 为汽车行业开发的一种串行通信总线。
由于其高性能、高可靠性以及独特的设计而越来越受到人们的重视，被广泛应用于诸多领域。
CAN协议分为二层：物理层和数据链路层。
CAN的信号传输采用短帧结构，传输时间短，具有自动关闭功能，具有较强的抗干扰能力。
CAN支持多主工作方式，并采用了非破坏性总线仲裁技术，通过设置优先级来避免冲突，通讯距离最远可达10KM/5Kbps/s，通讯速率最高可达40M /1Mbp/s，网络节点数实际可达110个。
由于CAN总线本身的特点,其应用范围目前已不再局限于汽车行业,而向自动控制、航空航天、航海、过程工业、机械工业、纺织机械、农用机械、机器人、数控机床、医疗器械及传感器等领域发展；







https://blog.csdn.net/tao475824827/article/details/103455403