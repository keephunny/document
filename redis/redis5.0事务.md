### redis事务

redis事务是一次性、顺序性、排他性的执行一个队列中的一系列命令。redis事务的本质是一组命令的集合，事务支持一次执行多个命令，一个事务中所有的命令都会被序列化。在事务执行过程，会按照顺序串行化执行队列中的命令，其它客户端提交的命令请求不会插入到事务执行命令序列中。



### 事务阶段

* 开始事务
* 命令入队
* 执行事务

```
#开启事务 ，设定事务开启的位置，
multi

#执行事务，设定事备结束的位置，
exec

#事务取消
discard

#监视key的变化，如果监视的key被其它命令改动，则事务将中断
watchh key [key2]

#取消watch命令对所有key的监视
unwatchh
```



**示列：**

```
redis 127.0.0.1:6379> multi
OK
redis 127.0.0.1:6379> set a aaa
QUEUED
redis 127.0.0.1:6379> set b bbb
QUEUED
redis 127.0.0.1:6379> set c ccc
QUEUED
redis 127.0.0.1:6379> exec
1) OK
2) OK
3) OK
```



### 事务原子性

单个redis命令的执行是原子性，但redis没有在事务止增加任何维持原子性的机制，所以redis事务的执行并不是原子性的。事务可以理解为一个打包的批量执行上脚本，但批量指令并非原子化操作，中间某条指令的失败不会导致前面已做的指令回滚，也不会造成后续的指令的中断。